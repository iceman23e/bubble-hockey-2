<!-- theme_manager.html -->
:::::: container
# Theme Manager

## Current Theme: {{ current_theme }}

:::: theme-list
### Available Themes

{% if themes %}
    {% for theme in themes %}
    ::: theme-item
    **{{ theme }}**
    <button class="theme-select" data-theme-id="{{ theme }}">Activate</button>
    <button onclick="exportTheme('{{ theme }}')">Export</button>
    :::
    {% endfor %}
{% else %}
    No themes available. Create a new theme below.
{% endif %}
::::

::: new-theme
### Create New Theme

Theme Name: <input type="text" id="new-theme-name">

#### Images

Background Image: 
<select id="background-image">
    {% for image in available_images %}
    <option value="{{ image }}">{{ image }}</option>
    {% endfor %}
</select>
Or upload a new image: <input type="file" id="upload-background-image">

#### Sounds

Goal Sound: 
<select id="goal-sound">
    {% for sound in available_sounds %}
    <option value="{{ sound }}">{{ sound }}</option>
    {% endfor %}
</select>
Or upload a new sound: <input type="file" id="upload-goal-sound">

#### Fonts

Small Font: 
<select id="small-font">
    {% for font in available_fonts %}
    <option value="{{ font }}">{{ font }}</option>
    {% endfor %}
</select>
Or upload a new font: <input type="file" id="upload-small-font">

<button onclick="createTheme()">Create Theme</button>
:::

::: import-theme
### Import Theme
<input type="file" id="import-theme-file">
<button onclick="importTheme()">Import Theme</button>
:::

::: theme-preview
### Theme Preview
<div id="preview-container">
    <!-- Preview content will be dynamically loaded here -->
</div>
:::

::::::

<script>
function updatePreview(themeId) {
    fetch(`/theme_preview/${themeId}`)
        .then(response => response.text())
        .then(html => {
            document.getElementById('preview-container').innerHTML = html;
        });
}

document.querySelectorAll('.theme-select').forEach(button => {
    button.addEventListener('click', function() {
        updatePreview(this.dataset.themeId);
    });
});

function exportTheme(themeName) {
    window.location.href = `/export_theme/${themeName}`;
}

function importTheme() {
    const fileInput = document.getElementById('import-theme-file');
    const formData = new FormData();
    formData.append('theme_file', fileInput.files[0]);

    fetch('/import_theme', {
        method: 'POST',
        body: formData
    })
    .then(response => response.text())
    .then(result => {
        alert(result);
        location.reload();
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

function createTheme() {
    // Implementation for theme creation
    // This should collect all the input values and send them to the server
    // Similar to the import function above
}
</script>
